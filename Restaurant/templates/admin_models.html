{% extends "base.html" %}

{% block title %}Manage Models - Admin{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="section-title mb-0">Manage Models</h1>
        <div>
            <button class="btn btn-luxury" onclick="showAddModelForm()">
                <i class="fas fa-plus me-2"></i>Add New Model
            </button>
            <a href="/admin/dashboard" class="btn btn-outline-secondary ms-2">Back to Dashboard</a>
        </div>
    </div>
    
    <!-- Add Model Form -->
    <div id="addModelForm" class="filter-section mb-4" style="display: none;">
        <h4 class="text-dark mb-4">Add New Model</h4>
        <form id="modelForm" enctype="multipart/form-data">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="name" class="form-label">Name *</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="age" class="form-label">Age *</label>
                    <input type="number" class="form-control" id="age" name="age" min="18" max="50" required>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="height" class="form-label">Height (cm) *</label>
                    <input type="number" class="form-control" id="height" name="height" min="150" max="200" required>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="city_id" class="form-label">City *</label>
                    <select class="form-control" id="city_id" name="city_id" required>
                        <option value="">Select a city</option>
                        {% for city in cities %}
                        <option value="{{ city.id }}">{{ city.name }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="hair_color" class="form-label">Hair Color *</label>
                    <select class="form-control" id="hair_color" name="hair_color" required>
                        <option value="">Select hair color</option>
                        <option value="Blonde">Blonde</option>
                        <option value="Brunette">Brunette</option>
                        <option value="Black">Black</option>
                        <option value="Red">Red</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
                <div class="col-md-6 mb-3">
                    <label for="eye_color" class="form-label">Eye Color *</label>
                    <select class="form-control" id="eye_color" name="eye_color" required>
                        <option value="">Select eye color</option>
                        <option value="Blue">Blue</option>
                        <option value="Brown">Brown</option>
                        <option value="Green">Green</option>
                        <option value="Hazel">Hazel</option>
                        <option value="Gray">Gray</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            
            <div class="mb-3">
                <label for="bio" class="form-label">Bio / Description</label>
                <textarea class="form-control" id="bio" name="bio" rows="4" 
                          placeholder="Model description, experience, specialties..."></textarea>
            </div>
            
            <div class="mb-4">
                <label for="photos" class="form-label">Photos *</label>
                <input type="file" class="form-control" id="photos" name="photos" multiple accept="image/*" required>
                <div class="form-text text-muted">
                    Upload high-quality photos (1 or more). Maximum 5MB per photo. Accepted formats: JPG, PNG.
                </div>
            </div>
            
            <div class="mb-3">
                <label for="status" class="form-label">Status</label>
                <select class="form-control" id="status" name="status">
                    <option value="approved">Approved</option>
                    <option value="pending">Pending</option>
                    <option value="rejected">Rejected</option>
                </select>
            </div>
            
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-luxury">
                    <i class="fas fa-save me-2"></i>Save Model
                </button>
                <button type="button" class="btn btn-secondary" onclick="hideAddModelForm()">Cancel</button>
            </div>
        </form>
    </div>
    
    <!-- Models List -->
    <div class="filter-section">
        <h4 class="text-dark mb-4">All Models</h4>
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Photo</th>
                        <th>Name</th>
                        <th>Age</th>
                        <th>Height</th>
                        <th>City</th>
                        <th>Hair</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for model in models %}
                    <tr>
                        <td>
                            {% if model.photos %}
                                {% set photos = model.photos | from_json %}
                                <img src="{{ photos[0] if photos else '/static/placeholder-model.jpg' }}" 
                                     alt="{{ model.name }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
                            {% else %}
                                <img src="/static/placeholder-model.jpg" alt="{{ model.name }}" 
                                     style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px;">
                            {% endif %}
                        </td>
                        <td>{{ model.name }}</td>
                        <td>{{ model.age }}</td>
                        <td>{{ model.height }}cm</td>
                        <td>{{ model.city.name if model.city else 'N/A' }}</td>
                        <td>{{ model.hair_color }}</td>
                        <td>
                            {% if model.status == 'approved' %}
                            <span class="badge bg-success">Approved</span>
                            {% elif model.status == 'pending' %}
                            <span class="badge bg-warning">Pending</span>
                            {% else %}
                            <span class="badge bg-danger">Rejected</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editModel({{ model.id }})">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteModel({{ model.id }})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function showAddModelForm() {
    document.getElementById('addModelForm').style.display = 'block';
    document.getElementById('addModelForm').scrollIntoView({ behavior: 'smooth' });
}

function hideAddModelForm() {
    document.getElementById('addModelForm').style.display = 'none';
    document.getElementById('modelForm').reset();
}

document.getElementById('modelForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const submitBtn = this.querySelector('button[type="submit"]');
    
    // Validate photos
    const photos = document.getElementById('photos').files;
    if (photos.length < 1) {
        alert('Please upload at least 1 photo.');
        return;
    }
    
    submitBtn.disabled = true;
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
    
    try {
        const response = await fetch('/admin/models/add', {
            method: 'POST',
            body: formData
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('Model added successfully!');
            location.reload();
        } else {
            alert(result.message);
        }
    } catch (error) {
        alert('Error adding model. Please try again.');
    } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-save me-2"></i>Save Model';
    }
});

async function deleteModel(modelId) {
    if (confirm('Are you sure you want to delete this model?')) {
        try {
            const response = await fetch(`/admin/models/${modelId}/delete`, {
                method: 'DELETE'
            });
            
            if (response.ok) {
                location.reload();
            } else {
                alert('Error deleting model');
            }
        } catch (error) {
            alert('Error deleting model');
        }
    }
}

function editModel(modelId) {
    alert('Edit functionality coming soon!');
}
</script>
{% endblock %}