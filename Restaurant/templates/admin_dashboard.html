{% extends "base.html" %}

{% block title %}Admin Dashboard - RED MARBS{% endblock %}

{% block content %}
<div class="container" style="margin-top: 100px;">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="section-title mb-0">Admin Dashboard</h1>
        <a href="/admin/logout" class="btn btn-outline-light">
            <i class="fas fa-sign-out-alt me-2"></i>Logout
        </a>
    </div>
    
    <!-- Stats Cards -->
    <div class="row mb-5">
        <div class="col-md-3 mb-3">
            <div class="city-card">
                <i class="fas fa-users fa-2x text-warning mb-3"></i>
                <h3>{{ stats.total_models }}</h3>
                <p class="text-muted">Total Models</p>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="city-card">
                <i class="fas fa-check-circle fa-2x text-success mb-3"></i>
                <h3>{{ stats.approved_models }}</h3>
                <p class="text-muted">Approved Models</p>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="city-card">
                <i class="fas fa-clock fa-2x text-warning mb-3"></i>
                <h3>{{ stats.pending_models }}</h3>
                <p class="text-muted">Pending Applications</p>
            </div>
        </div>
        <div class="col-md-3 mb-3">
            <div class="city-card">
                <i class="fas fa-calendar-alt fa-2x text-info mb-3"></i>
                <h3>{{ stats.total_bookings }}</h3>
                <p class="text-muted">Total Bookings</p>
            </div>
        </div>
    </div>
    
    <div class="row">
        <!-- Recent Applications -->
        <div class="col-lg-6 mb-4">
            <div class="filter-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="text-warning">Recent Applications</h4>
                    <a href="/admin/models" class="btn btn-outline-light btn-sm">View All</a>
                </div>
                
                {% if recent_applications %}
                <div class="table-responsive">
                    <table class="table table-dark">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Age</th>
                                <th>City</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for model in recent_applications %}
                            <tr>
                                <td>{{ model.name }}</td>
                                <td>{{ model.age }}</td>
                                <td>{{ model.city.name if model.city else 'N/A' }}</td>
                                <td>
                                    <span class="badge bg-warning">{{ model.status.title() }}</span>
                                </td>
                                <td>
                                    <button class="btn btn-success btn-sm me-1" onclick="approveModel({{ model.id }})">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    <button class="btn btn-danger btn-sm" onclick="rejectModel({{ model.id }})">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted text-center py-3">No pending applications</p>
                {% endif %}
            </div>
        </div>
        
        <!-- Recent Bookings -->
        <div class="col-lg-6 mb-4">
            <div class="filter-section">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="text-warning">Recent Bookings</h4>
                    <a href="/admin/bookings" class="btn btn-outline-light btn-sm">View All</a>
                </div>
                
                {% if recent_bookings %}
                <div class="table-responsive">
                    <table class="table table-dark">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Contact</th>
                                <th>Model</th>
                                <th>Event Type</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for booking in recent_bookings %}
                            <tr>
                                <td>{{ booking.client_name }}</td>
                                <td>
                                    <small>{{ booking.client_email }}</small><br>
                                    {% if booking.client_phone %}
                                    <small>{{ booking.client_phone }}</small>
                                    {% endif %}
                                </td>
                                <td>{{ booking.model.name }}</td>
                                <td>{{ booking.event_type }}</td>
                                <td>
                                    {% if booking.status == 'pending' %}
                                    <span class="badge bg-warning">Pending</span>
                                    {% elif booking.status == 'confirmed' %}
                                    <span class="badge bg-success">Confirmed</span>
                                    {% else %}
                                    <span class="badge bg-danger">Cancelled</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if booking.status == 'pending' %}
                                    <button class="btn btn-success btn-sm" onclick="confirmBooking({{ booking.id }})">
                                        <i class="fas fa-check"></i>
                                    </button>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-muted text-center py-3">No recent bookings</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="filter-section">
                <h4 class="text-warning mb-3">Quick Actions</h4>
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="/admin/models" class="btn btn-luxury w-100">
                            <i class="fas fa-users me-2"></i>Manage Models
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="/admin/bookings" class="btn btn-luxury w-100">
                            <i class="fas fa-calendar-alt me-2"></i>Manage Bookings
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <button class="btn btn-luxury w-100" onclick="exportData()">
                            <i class="fas fa-download me-2"></i>Export Data
                        </button>
                    </div>
                    <div class="col-md-3 mb-3">
                        <button class="btn btn-luxury w-100" onclick="viewAnalytics()">
                            <i class="fas fa-chart-bar me-2"></i>Analytics
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
async function approveModel(modelId) {
    if (confirm('Approve this model application?')) {
        try {
            const response = await fetch(`/admin/models/${modelId}/approve`, {
                method: 'POST'
            });
            
            if (response.ok) {
                location.reload();
            } else {
                alert('Error approving model');
            }
        } catch (error) {
            alert('Error approving model');
        }
    }
}

async function rejectModel(modelId) {
    if (confirm('Reject this model application?')) {
        try {
            const response = await fetch(`/admin/models/${modelId}/reject`, {
                method: 'POST'
            });
            
            if (response.ok) {
                location.reload();
            } else {
                alert('Error rejecting model');
            }
        } catch (error) {
            alert('Error rejecting model');
        }
    }
}

async function confirmBooking(bookingId) {
    if (confirm('Confirm this booking?')) {
        try {
            const response = await fetch(`/admin/bookings/${bookingId}/confirm`, {
                method: 'POST'
            });
            
            if (response.ok) {
                location.reload();
            } else {
                alert('Error confirming booking');
            }
        } catch (error) {
            alert('Error confirming booking');
        }
    }
}

function exportData() {
    alert('Export functionality coming soon!');
}

function viewAnalytics() {
    alert('Analytics dashboard coming soon!');
}

// Auto-refresh dashboard every 30 seconds
setInterval(() => {
    location.reload();
}, 30000);
</script>
{% endblock %}